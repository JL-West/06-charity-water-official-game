<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adam's Ale</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Simple visually hidden heading for screen readers -->
    <h1 class="sr-only">Welcome to Adam's Ale</h1>

    <!-- First screen: Main menu / intro -->
    <div id="screen-1" class="app-screen screen-center">
        <div class="card intro-card">
            <h2>Adam's Ale</h2>
            <p class="lead">Welcome, traveller! Embark on a quest: place gear, gather supplies, and bring them to the hamlet.</p>
            <!-- Replace the intro wireframe with a clickable jerrycan that links to charity:water -->
            <div class="wireframe-preview" style="margin:12px 0;">
                <a class="jerrycan-link" href="https://www.charitywater.org/" target="_blank" rel="noopener noreferrer" aria-label="Brought to You By charity:water (opens in new tab)">
                    <img src="img/water-can.png" alt="charity:water jerrycan" class="big-jerry" onerror="this.style.display='none'" />
                    <span class="jerrycan-tooltip" aria-hidden="true">Brought to You By charity:water</span>
                </a>
                <!-- (no SVG fallback ‚Äî hide placeholder so jerrycan CTA doesn't look small if image is missing) -->
            </div>
                <!-- (jerrycan CTA moved into the wireframe area above) -->
                <div class="intro-actions">
                    <button id="loadBtn" class="btn">Continue (Load)</button>
                    <button id="createCharBtn" class="btn">Create Character</button>
                </div>
                
            <!-- Inline, non-blocking indicator shown next to the load button -->
            <div style="display:flex;align-items:center;justify-content:center;margin-top:8px;gap:8px;">
                <div id="inlineIndicator" class="inline-indicator hidden" role="status" aria-live="polite" aria-hidden="true" style="display:flex;align-items:flex-end;gap:8px;">
                    <!-- decorative jerrycan SVG; fill is updated via JS (height + y) -->
                    <svg id="jerrySvg" class="jerry-svg" width="36" height="44" viewBox="0 0 36 44" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                        <!-- body outline -->
                        <rect x="2" y="6" width="32" height="30" rx="4" fill="none" stroke="#2b3742" stroke-width="1" />
                        <!-- neck/handle -->
                        <rect x="24" y="2" width="8" height="8" rx="2" fill="#ffffff" stroke="#2b3742" stroke-width="1" />
                        <!-- water rect (we update height and y via JS). initial height=0 -->
                        <rect id="jerryWater" x="3" y="36" width="30" height="0" fill="#2ea7f7" />
                    </svg>
                    <span class="inline-spinner" aria-hidden="true"></span>
                    <span id="inlineIndicatorText" class="inline-text">Loading...</span>
                    <span id="inlineIndicatorPct" class="inline-pct">0%</span>
                </div>
            </div>
            <p class="small">This prototype uses simple HTML/CSS/JS so students can learn DOM programming.</p>

            <!-- (Removed large jerrycan badge and restored small inline credit near the load indicator) -->

            <!-- Restore original Figma button below the preview -->
            <div style="margin-top:8px;">
                <a class="btn" href="https://www.figma.com/proto/dcjWRW8CHaVQE1QV38d0yE/Adam-s-Ale?node-id=0-1&t=o031IUey9KEXQKv1-1" target="_blank" rel="noopener noreferrer">Open Figma Wireframe</a>
            </div>
        </div>
    </div>

    <!-- Third screen: Character creator (simple form) -->
    <div id="screen-3" class="app-screen hidden screen-center">
        <div class="card intro-card" style="width:480px;">
            <h2>Create Your Character</h2>
            <p class="lead">Choose a name and avatar for your character.</p>
            <div style="margin:10px 0; display:flex; gap:12px; align-items:center;">
                <label for="charName" style="min-width:80px;">Name</label>
                <input id="charName" type="text" placeholder="Enter name" style="flex:1; padding:8px; border-radius:6px; border:1px solid #e6eef6;" />
            </div>
            <div style="margin:8px 0;">
                <h4 style="margin:6px 0;">Choose avatar</h4>
                <div id="avatarList" style="display:flex;gap:8px;align-items:center;">
                    <button class="avatar-option" data-avatar="avatar-1">üë©</button>
                    <button class="avatar-option" data-avatar="avatar-2">üßë</button>
                    <button class="avatar-option" data-avatar="avatar-3">üßë‚Äçüåæ</button>
                    <button class="avatar-option" data-avatar="avatar-4">üßï</button>
                </div>
            </div>
            <div style="display:flex;gap:8px;justify-content:center;margin-top:12px;">
                <button id="saveCharBtn" class="btn primary">Save Character</button>
                <button id="cancelCharBtn" class="btn">Cancel</button>
            </div>
            <p class="small">This is a minimal character creator for the prototype.</p>
        </div>
    </div>

    <!-- Second screen: Desktop / Laptop layout -->
    <div id="screen-2" class="app-screen hidden">
        <header class="app-header">
            <div class="left">
                <button id="backBtn" class="btn">‚Üê Back</button>
                <h2>Adam's Ale ‚Äî Community Well Project</h2>
            </div>
            <div class="right">
                <!-- Sound controls: mute toggle, volume slider and now-playing -->
                <div style="display:inline-flex;align-items:center;gap:8px;margin-left:8px;">
                    <button id="soundToggle" class="btn" aria-pressed="false">üîä</button>
                    <input id="soundVolume" type="range" min="0" max="1" step="0.05" value="0.8" style="width:98px;" aria-label="Sound volume" />
                    <button id="enableSoundBtn" class="btn medieval-btn" title="Enable audio for synth SFX and music">Harken!</button>
                    <button id="musicToggleBtn" class="btn medieval-btn" title="Play / Pause background music">Let Music Play</button>
                    <div id="nowPlaying" class="now-playing" aria-live="polite" style="display:none;"></div>
                    <!-- Difficulty selector and Achievements -->
                    <label for="difficultySelect" style="margin-left:10px;font-size:0.85rem;color:#090909;display:inline-flex;align-items:center;gap:6px;">
                        <span style="font-size:0.75rem;color:rgba(255,255,255,0.9);">Difficulty</span>
                        <select id="difficultySelect" style="padding:6px;border-radius:6px;border:1px solid rgba(0,0,0,0.08);background:#fff;color:#0f172a;">
                            <option value="easy">Easy</option>
                            <option value="normal" selected>Normal</option>
                            <option value="hard">Hard</option>
                        </select>
                    </label>
                    <button id="achievementsBtn" class="btn" title="View achievements">üèÜ</button>
                    <button id="toggleFPBtn" class="btn" title="Toggle First-Person View">üëÅÔ∏è FP</button>
                </div>
            </div>
        </header>

        <main class="app-main">
            <!-- Left panel: player / mission info -->
            <aside class="panel left-panel">
                <section class="profile card">
                    <h3>Player</h3>
                    <p id="playerNameLine"><span id="playerAvatar" class="player-avatar" aria-hidden="true"></span> <span id="playerName">Player 1</span></p>
                    <p>Gold: $<span id="funds">100</span></p>
                    <p>Aid Delivered: <span id="waterDelivered">0</span></p>
                </section>

                <section class="mission card">
                <h3>Quest</h3>
                    <p>Prepare supplies and help the nearby hamlet ‚Äî undertake quests and bring aid.</p>
                    <button id="startMission" class="btn primary">Restart</button>
                </section>

                <!-- Configuration panel moved here so it doesn't block the Challenges panel -->
                <section id="configPanel" class="config card" style="margin-top:12px;">
                    <h3>Configuration</h3>
                    <div class="row"><label for="enemyDensity">Enemy density</label>
                        <select id="enemyDensity"><option value="auto">Auto (per difficulty)</option><option value="low">Low</option><option value="normal">Normal</option><option value="high">High</option></select>
                    </div>
                    <div class="row"><label for="theftChanceSlider">Theft chance (deliveries)</label>
                        <input id="theftChanceSlider" type="range" min="0" max="50" step="1" value="10" aria-label="Theft chance percent" />
                    </div>
                    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px;">
                        <button id="resetConfigBtn" class="btn">Reset Defaults</button>
                    </div>
                </section>
            </aside>

            <!-- Center: map / placement area -->
            <section class="game-area card">
                <h3>World Map</h3>
                <!-- First-person view panel (toggled) -->
                <div id="fpView" class="fp-view hidden" aria-hidden="true" style="border:1px solid #e6eef6;padding:8px;margin-bottom:8px;background:#fff;">
                    <div id="fpText">First-person view: Stand at Plot 1.</div>
                </div>
                <div id="mapGrid" class="map-grid" aria-label="Site map">
                    <!-- map tiles generated by JS -->
                </div>

                <div class="map-actions">
                        <button id="deliverWater" class="btn primary">Deliver / Quest</button>
                    <span id="statusText" class="status">Select a tool from the shop and click a tile to place it.</span>
                </div>
            </section>

            <!-- Right panel: shop / items -->
            <aside class="panel right-panel">
                <section class="shop card">
                    <h3>Market</h3>
                    <div id="shopList" class="shop-list">
                        <!-- shop items generated by JS -->
                    </div>
                </section>

                <section class="inventory card">
                    <h3>Satchel</h3>
                    <ul id="inventoryList">
                        <li>No items placed yet.</li>
                    </ul>
                </section>
                <!-- Challenges panel: small list of short tasks players can accept -->
                <section class="challenges card" style="margin-top:12px;">
                    <h3>Challenges</h3>
                    <div id="challengesList" style="display:flex;flex-direction:column;gap:8px;">
                        <!-- JS will render daily/rotating challenges here -->
                    </div>
                </section>
                
                <!-- Move Help button here so header isn't crowded -->
                <div style="margin-top:12px; text-align:center;">
                    <button id="helpBtn" class="btn">Help</button>
                </div>
            </aside>
        </main>

        <footer class="app-footer">
            <small>Desktop preview ‚Äî responsive layout intended for laptop/desktop</small>
        </footer>
    <!-- loader overlays are provided by the simple spinner in `#simpleLoader` -->

        <!-- NPC Quest Dialog (hidden by default) -->
        <div id="npcDialog" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="npcDialogTitle">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <h3 id="npcDialogTitle">Quest Offer</h3>
                <p id="npcDialogText">A villager needs help collecting supplies. Will you accept?</p>
                <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
                    <button id="npcDeclineBtn" class="btn">Decline</button>
                    <button id="npcAcceptBtn" class="btn primary">Accept Quest</button>
                </div>
                <button id="npcCloseBtn" class="btn" style="position:absolute;top:8px;right:8px;">Close</button>
            </div>
        </div>

            <!-- Confirm Reset Dialog -->
            <div id="confirmResetDialog" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirmResetTitle">
                <div class="modal-backdrop"></div>
                <div class="modal-content">
                    <h3 id="confirmResetTitle">Restart Game</h3>
                    <p id="confirmResetText">Are you sure you want to clear progress?</p>
                    <label style="display:flex;align-items:center;gap:8px;margin-top:8px;"><input id="wipeCharacterCheckbox" type="checkbox"> Also remove character (name & avatar)</label>
                    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
                        <button id="resetCancelBtn" class="btn">Cancel</button>
                        <button id="resetConfirmBtn" class="btn primary">Confirm</button>
                    </div>
                </div>
            </div>

            <!-- Achievements dialog (kept separate, sibling to confirm dialog) -->
            <div id="achievementsDialog" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="achievementsTitle">
                <div class="modal-backdrop"></div>
                <div class="modal-content">
                    <h3 id="achievementsTitle">Achievements</h3>
                    <div id="achievementsList" style="max-height:320px;overflow:auto;margin-top:8px;">
                        <!-- Achievements rendered by JS -->
                    </div>
                    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
                        <button id="clearAchievementsBtn" class="btn">Clear</button>
                        <button id="closeAchievementsBtn" class="btn primary">Close</button>
                    </div>
                </div>
            </div>

        <script src="script.js"></script>
    <!-- Hidden container for YouTube music player (controlled via JS) -->
    <div id="yt-music-container" style="display:none;width:0;height:0;overflow:hidden;" aria-hidden="true"></div>
</body>
</html>